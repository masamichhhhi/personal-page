---
import { getCollection } from 'astro:content';
import BaseLayout from '@layouts/BaseLayout.astro';
import BlogCard from '@components/BlogCard.astro';
import Pagination from '@components/Pagination.astro';
import SectionHeader from '@components/blog/SectionHeader.astro';

const POSTS_PER_PAGE = 10;
const currentPage = 1;

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = allPosts.sort(
  (a, b) => b.data.publishedAt.valueOf() - a.data.publishedAt.valueOf()
);

const totalPages = Math.ceil(sortedPosts.length / POSTS_PER_PAGE);
const posts = sortedPosts.slice(0, POSTS_PER_PAGE);
---

<BaseLayout title="Blog | masamichhhi" description="Read my thoughts on technology, development, and more.">
  <div class="container py-12 blog-shell" id="top">
    <header class="blog-hero p-8 md:p-12 mb-12">
      <p class="blog-label">Journal</p>
      <h1 class="text-4xl md:text-6xl font-semibold blog-ink mt-4 mb-4">
        Blog
      </h1>
      <p class="text-lg md:text-xl blog-muted max-w-2xl">
        Thoughts, tutorials, and insights on technology and development.
      </p>
      <div class="mt-6 flex flex-wrap items-center gap-4 text-sm blog-muted">
        <span>Latest updates</span>
        <span class="blog-brand">Curated highlights</span>
      </div>
    </header>

    <section id="archive" class="pt-6">
      <SectionHeader
        title="Archive"
        description="All posts (newest first)"
        actionLabel="Back to top"
        actionHref="#top"
      />

      {posts.length > 0 ? (
        <div class="mt-6 space-y-6">
          {posts.map((post) => (
            <BlogCard
              title={post.data.title}
              slug={post.slug}
              publishedAt={post.data.publishedAt}
              summary={post.data.summary}
              tags={post.data.tags}
              readingTime={post.data.readingTime}
            />
          ))}
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-gray-600 text-lg">No articles yet.</p>
          <p class="text-gray-500 mt-2">Check back soon for new content!</p>
        </div>
      )}

      <div class="mt-10">
        <Pagination currentPage={currentPage} totalPages={totalPages} baseUrl="/blog" />
      </div>
    </section>
  </div>
</BaseLayout>
